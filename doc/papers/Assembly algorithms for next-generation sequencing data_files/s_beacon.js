var CIPA={_gadgetContext:"",setGadgetContext:function(e){_gadgetContext=e},init:function(){$(window).load(CIPA.sendPage());$(window).load(CIPA.sendResources(2e3));$(window).unload(function(){CIPA.sendResources(0)})},hashCode:function(e){var t=0;if(e.length==0)return t;for(i=0;i<e.length;i++){var n=e.charCodeAt(i);t=(t<<5)-t+n;t=t&t}return t},sendPage:function(){var e=window.performance;var t="";t+="cpc="+_gadgetContext.platform;t+="&pagetype="+_gadgetContext.pageType;t+="&sdsh="+CIPA.hashCode(_gadgetContext.sds);t+="&tidh="+CIPA.hashCode(_gadgetContext.tid);if(document.location.href)t+="&href="+encodeURIComponent(document.location.href);t+="&domCount="+document.getElementsByTagName("*").length;if("performance"in window){if(e.timing){var n=e.timing;if(n.loadEventEnd>0){for(var r in n)t+="&"+r+"="+n[r];var i=_gadgetContext.prDevice+"/gadgets?"+t;$("body").append('<img style="display:none" src="'+i+'">')}else setTimeout(CIPA.sendPage,100)}}else{var i=_gadgetContext.prDevice+"/gadgets?"+t;$("body").append('<img style="display:none" src="'+i+'">')}},toInt:function(e){return Math.round(Number(e)).toString()},buildResources:function(e,t){var n=window.performance.timing;var r=$("iframe");var i=n.navigationStart;var s=n.responseStart-i;var o=n.domInteractive-i;var u=n.loadEventEnd-i;var a=window.performance.getEntries();var f=[];var l=CIPA.hashCode(_gadgetContext.sds);var c=CIPA.hashCode(_gadgetContext.tid);f.push({sdsh:l,tidh:c,ns:i});var h=CIPA.sc[CIPA.sc.length-1];for(var p=h;p<e;p++){var d=a[p].name.match(/^https?\:\/\/([^\/\s]+)((\/\w+)*\/)([\w\-\.]+[^#?\s]+)(.*)?(#[\w\-]+)?$/i);if(d===null){var v="";var m=""}else{var g=d[2].split("/");if(g.length>=4)var v=g[1]+"/"+g[2]+"/"+g[3];else if(g.length==3)var v=g[1]+"/"+g[2];else if(g.length==2)var v=g[1];else var v="";var m=d[1];if(g[2]=="frag")if(d[4].split("_")[1]!=undefined)fragID=d[4].split("_")[1];else if(d[4]=="maps")fragID=0;else if(d[4]=="all")fragID=32767;else fragID="";else fragID=""}f.push({i:p,tm:CIPA.toInt(a[p].startTime)+"|"+CIPA.toInt(a[p].responseStart)+"|"+CIPA.toInt(a[p].duration),t:a[p].initiatorType,h:m,p:v})}var y=encodeURI(JSON.stringify(f));var a=_gadgetContext.prDevice+"/resource?"+y;$("body").append('<img style="display:none" src="'+a+'">');CIPA.sc.push(e);CIPA.loopc=[0]},ec:[0],sc:[0],loopc:[0],u:0,sendResources:function(e){if(typeof e!="undefined"&&e>0)var t=e;else var t=0;var n=CIPA.ec;if("performance"in window){var r=window.performance;if("timing"in r)var i=r.timing;if("getEntries"in r){var s=r.getEntries().length;CIPA.ec.push(s);ecl=CIPA.ec.length-1;ecC=CIPA.ec[ecl]-CIPA.ec[ecl-1];ecLast=CIPA.ec[ecl-1];var o=CIPA.ec[ecl]-CIPA.ec[ecl-1];if(CIPA.ec[ecl]==CIPA.ec[ecl-1]||CIPA.ec[ecl]-CIPA.ec[ecl-1]<5){CIPA.loopc.push(0);if(CIPA.loopc.length<3)setTimeout(function(){CIPA.sendResources(t)},t)}else{var u=CIPA.sc[CIPA.sc.length-1];for(var a=u;s-a>0;a=a+15){var u=CIPA.sc[CIPA.sc.length-1];CIPA.buildResources(a,s);if(s-a<15){var f=s-a;CIPA.buildResources(s,s)}}}}}}}